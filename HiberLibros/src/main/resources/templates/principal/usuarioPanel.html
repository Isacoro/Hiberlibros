<html xmlns:th="https://www.thymeleaf.org" 
      th:replace="principal/layoutUsuario::layout(~{::body})">

    <body>
        <div class="container-fluid">
            <div class="row">
                <div class='col-7'>
                    <h2>Tus libros</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ISBN</th>
                                <th>Titulo</th>
                                <th>Idioma</th>
                                <th>Editorial</th>
                                <th>Genero</th>
                                <th>Valoracion</th>
                                <th>Estado</th>
                                <th>Quiero/Tengo</th>
                                <th>Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each='l:${libros}'>
                                <td th:text="${l.libro.isbn}"></td>
                                <td th:text="${l.libro.titulo}"></td>
                                <td th:text="${l.libro.idioma}"></td>
                                <td th:text="${l.libro.editorial.nombreEditorial}"></td>
                                <td th:text="${l.libro.genero.nombre}"></td>
                                <td th:text="${l.libro.valoracionLibro}"></td>
                                <td th:text="${l.estadoConservacion}"></td>
                                <td th:text="${l.quieroTengo}"></td>
                                <td><a th:href="@{/hiberlibros/borrarUL(id=${l.id})}" class="btn btn-sm btn-secondary">Borrar</a></td>
                            </tr>
                        </tbody>
                    </table>
                    <a href="/hiberlibros/guardarLibro" class="btn btn-primary"><i class="fas fa-plus-square"></i>&nbsp;añadir libro</a>
                </div>
                <div class='col-5'>
                    <h2>Tus relatos</h2>
                    <table class="table"  >
                        <tr>
                            <!--                            <th>id</th>-->
                            <th>titulo</th>
                            <th>Género</th>
                            <th>Valoraciones</th>
                            <th>NºValoraciones</th>
                        </tr>
                        <tr th:each="rel:${relatos}">    
                            <!--                            <td th:text="${rel.id}"></td>  -->
                            <td th:text="${rel.titulo}"></td>
                            <td th:text="${rel.genero.nombre}"></td>   
                            <td class="text-center"> 
                                <span th:text="${rel.valoracionUsuarios}" ></span>
                                <i class="fas fa-star" style="color:orange"></i>     
                            </td>  
                            <td th:text="${rel.numeroValoraciones}" style="text-align: center"></td> 

                        </tr>
                    </table>
                    <a th:href="@{/hiberlibros/relato(id=${usuario.id})}" class="btn btn-primary"><i class="fas fa-plus-square"></i>&nbsp;añadir relato</a>

                </div>
            </div>
            <div class="row">
                <div class='col-6'>
                    <h2>Nuevas Peticiones</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Libro</th>
                                <th>Usuario</th>
                                <th>Gestionar</th>
                            </tr>                           
                        </thead>
                        <tbody>
                            <tr th:each="petiR:${petiRecibidas}">
                                <td th:text="${petiR.idUsuarioLibro.libro.titulo}"></td>
                                <td th:text="${petiR.idUsuarioSolicitante.nombre}"></td>
                                <td><a th:onclick="|gestionarPeticion(${petiR.id})|" class="btn btn-sm btn-secondary">Gestionar</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class='col-6'>
                    <h2>Tus peticiones</h2>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Libro</th>
                                <th>Estado</th>
                                <th>Retirar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="peti:${misPeticiones}">
                                <td th:text="${peti.idUsuarioLibro.usuario.nombre}"></td>
                                <td th:text="${peti.idUsuarioLibro.libro.titulo}"></td>
                                <td>Pendiente</td>
                                <td><a th:href="@{/peticion/baja(id=${peti.id},mail=${usuario.mail})}" class="btn btn-secondary btn-sm">Retirar</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class='row'>
                <div class='col-12'>
                    <h2>Intercambios</h2>
                    <table class="table"  >
                        <thead>
                            <tr>
                                <th>Usuario</th>
                                <th>Libro Prestado</th>
                                <th>Libro Recibido</th>
                                <th>Fecha de Inicio</th>
                                <th>Fecha de devolución</th>
                                <th>Finalizar intercambio</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="inter:${intercambiosPropios}">
                                <td th:text="${inter.usuarioPrestatario.usuario.nombre}"></td>
                                <td th:text="${inter.usuarioPrestador.libro.titulo}"></td>
                                <td th:text="${inter.usuarioPrestatario.libro.titulo}"></td>
                                <td th:text="${inter.fechaPrestamo}"></td>
                                <td th:text="${inter.fechaDevolucion!=null?inter.fechaDevolucion:'Préstamo en curso'}"></td>
                                <td><span th:if='${inter.fechaDevolucion==null}'><a th:href='@{/hiberlibros/finIntercambio(id=${inter.id}, id_usuario=${usuario.id})}' class='btn btn-secondary'>Finalizar</a></span></td>
                            </tr>
                            <tr th:each="interP:${intercambiosPeticiones}">
                                <td th:text="${interP.usuarioPrestador.usuario.nombre}"></td>
                                <td th:text="${interP.usuarioPrestatario.libro.titulo}"></td>
                                <td th:text="${interP.usuarioPrestador.libro.titulo}"></td>
                                <td th:text="${interP.fechaPrestamo}"></td>
                                <td th:text="${interP.fechaDevolucion!=null?interP.fechaDevolucion:'Préstamo en curso'}"></td>
                                <td><span th:if='${interP.fechaDevolucion==null}'><a th:href='@{/hiberlibros/finIntercambio(id=${interP.id}, id_usuario=${usuario.id})}' class='btn btn-secondary'>Finalizar</a></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <a th:onclick="|eliminarU(${usuario.id})|" class="btn btn-outline-danger" title='Borrar usuario'>Borrar</a>
    </body>

</html>
